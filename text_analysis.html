<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Text Analysis - Blue & White Museum</title>
    <!-- ÂºïÂÖ•‰∏≠ÊñáÂ≠ó‰Ωì -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- ECharts -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <!-- Chart.js for ÂÖ∂‰ªñÂõæË°® -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* ÈùíËä±Áì∑‰∏ªÈ¢òËâ≤ÂΩ©‰ΩìÁ≥ª */
            --blue-dark: #1a4d7a;
            --blue-medium: #2d7fc1;
            --blue-light: #a8d5e2;
            --porcelain-white: #f8f8f6;
            --ink-black: #2c2c2c;
            --seal-red: #c94a3d;
            --paper-beige: #f5f1e8;
        }

        body {
            font-family: 'Noto Serif SC', 'ÊÄùÊ∫êÂÆã‰Ωì', 'SimSun', serif;
            background: linear-gradient(135deg, var(--blue-medium) 0%, var(--blue-light) 100%);
            min-height: 100vh;
            padding: 40px 20px 20px;
            line-height: 1.7;
            letter-spacing: 0.02em;
        }

        .page-layout {
            display: flex;
        }

        .nav-column {
            position: fixed;
            top: 25px;
            left: 25px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            z-index: 10;
        }

        .nav-link {
            background: transparent;
            border: none;
            color: rgba(255,255,255,0.85);
            font-size: 1rem;
            letter-spacing: 0.35em;
            padding: 6px 0;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            text-align: left;
            font-family: 'Noto Serif SC', serif;
            font-weight: 500;
        }

        .nav-link:hover {
            text-shadow: 0 10px 22px rgba(0, 0, 0, 0.3), 0 0 28px rgba(255,255,255,0.65);
        }

        .main-content {
            margin-left: 0;
            width: 100%;
            padding-top: 10px;
        }

        .title-container {
            text-align: center;
            margin-bottom: 30px;
        }

        .title-container h1 {
            color: white;
            font-size: 2.5rem;
            font-weight: 700;
            text-shadow: 2px 2px 8px rgba(0,0,0,0.5), 0 0 20px rgba(26, 77, 122, 0.4);
            letter-spacing: 0.1em;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            text-align: center;
        }

        .stat-card .value {
            font-size: 2em;
            font-weight: 700;
            color: var(--blue-medium);
            margin: 10px 0;
        }

        .stat-card .label {
            color: #666;
            font-size: 0.9em;
        }

        .analysis-container {
            display: flex;
            flex-direction: column;
            gap: 30px;
            margin-bottom: 30px;
        }

        .chart-card {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: row;
            gap: 30px;
            align-items: flex-start;
        }

        .chart-card h3 {
            margin: 0 0 20px 0;
            color: var(--blue-dark);
            font-size: 1.3em;
            font-weight: 600;
            border-bottom: 2px solid var(--blue-medium);
            padding-bottom: 10px;
            width: 100%;
        }

        .chart-wrapper {
            flex: 1;
            min-width: 0;
        }

        .chart-container {
            position: relative;
            height: 400px;
            margin-top: 10px;
        }

        .chart-container.large {
            height: 700px;
        }

        .chart-container.small {
            height: 300px;
        }

        .analysis-text {
            flex: 1;
            min-width: 0;
            padding-left: 20px;
            border-left: 2px solid var(--blue-light);
        }

        .analysis-text h4 {
            color: var(--blue-dark);
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: 12px;
        }

        .analysis-text p {
            color: #555;
            line-height: 1.8;
            font-size: 0.95em;
            margin-bottom: 10px;
        }

        .analysis-text ul {
            color: #555;
            line-height: 1.8;
            font-size: 0.95em;
            padding-left: 20px;
            margin-top: 10px;
        }

        .analysis-text li {
            margin-bottom: 8px;
        }

        @media (max-width: 900px) {
            .chart-card {
                flex-direction: column;
            }

            .analysis-text {
                padding-left: 0;
                padding-top: 20px;
                border-left: none;
                border-top: 2px solid var(--blue-light);
            }
        }

        .keyword-cloud {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            padding: 20px;
            justify-content: center;
            align-items: center;
        }

        .keyword-tag {
            padding: 8px 15px;
            border-radius: 20px;
            background: linear-gradient(135deg, var(--blue-light), var(--blue-medium));
            color: white;
            font-size: 14px;
            font-weight: 500;
            transition: transform 0.2s;
            cursor: pointer;
        }

        .keyword-tag:hover {
            transform: scale(1.1);
        }

        .relationship-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-top: 30px;
            box-shadow: 0 8px 24px rgba(26, 77, 122, 0.15);
        }

        .relationship-section h2 {
            color: var(--blue-dark);
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 20px;
            text-align: center;
            letter-spacing: 0.05em;
            border-bottom: 3px solid var(--blue-medium);
            padding-bottom: 15px;
        }

        .relationship-section .description {
            text-align: center;
            color: #666;
            margin-bottom: 20px;
            line-height: 1.8;
        }

        .relationship-content {
            display: flex;
            gap: 30px;
            align-items: flex-start;
        }

        .relationship-chart-wrapper {
            flex: 1;
        }

        #relationship-chart {
            width: 100%;
            height: 800px;
            min-height: 600px;
        }

        .relationship-analysis {
            flex: 1;
            padding-left: 20px;
            border-left: 2px solid var(--blue-light);
        }

        @media (max-width: 900px) {
            .relationship-content {
                flex-direction: column;
            }

            .relationship-analysis {
                padding-left: 0;
                padding-top: 20px;
                border-left: none;
                border-top: 2px solid var(--blue-light);
            }
        }

        @media (max-width: 900px) {
            .page-layout {
                flex-direction: column;
                align-items: center;
            }

            .nav-column {
                position: static;
                flex-direction: row;
                justify-content: center;
                gap: 15px;
                margin-bottom: 20px;
            }

            .nav-link {
                letter-spacing: 0.2em;
                text-align: center;
                font-size: 0.9rem;
            }

            .main-content {
                padding-top: 0;
            }
        }
    </style>
</head>
<body>
    <div class="page-layout">
        <div class="nav-column">
            <button class="nav-link" onclick="window.location.href='index.html'">MAIN PAGE</button>
        </div>
        <div class="main-content">
            <div class="container">
                <div class="title-container">
                    <h1>TEXT ANALYSIS</h1>
                </div>

                <!-- Statistics Cards -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="label">Total Descriptions</div>
                        <div class="value" id="stat-total">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="label">Average Length</div>
                        <div class="value" id="stat-avg-length">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="label">Total Keywords</div>
                        <div class="value" id="stat-keywords">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="label">Unique Keywords</div>
                        <div class="value" id="stat-unique">0</div>
                    </div>
                </div>

                <!-- Analysis Charts Area -->
                <div class="analysis-container">
                    <div class="chart-card">
                        <div class="chart-wrapper">
                            <h3>üî§ Keyword Frequency (Top 20)</h3>
                            <div class="chart-container">
                                <canvas id="keyword-chart"></canvas>
                            </div>
                        </div>
                        <div class="analysis-text">
                            <h4>Analysis</h4>
                            <p>The keyword frequency chart displays the top 20 most frequently occurring terms in the blue and white porcelain descriptions, revealing the dominant themes and characteristics emphasized in the collection's documentation.</p>
                            <p>Key observations:</p>
                            <ul>
                                <li>High-frequency keywords indicate common decorative motifs, materials, or stylistic features</li>
                                <li>The distribution shows which aspects of the artifacts are most prominently described</li>
                                <li>Rare keywords may represent unique or specialized characteristics</li>
                                <li>This analysis helps understand the vocabulary and descriptive patterns used in cataloging</li>
                            </ul>
                        </div>
                    </div>

                    <div class="chart-card">
                        <div class="chart-wrapper">
                            <h3>‚òÅÔ∏è Keyword Cloud</h3>
                            <div class="chart-container small">
                                <canvas id="wordcloud-chart"></canvas>
                            </div>
                        </div>
                        <div class="analysis-text">
                            <h4>Analysis</h4>
                            <p>The keyword cloud provides a visual representation of term frequency, where the prominence of words reflects their occurrence in the descriptive texts. This visualization offers an intuitive overview of the collection's thematic landscape.</p>
                            <p>Insights:</p>
                            <ul>
                                <li>Visual weight corresponds to textual importance and frequency</li>
                                <li>Clusters of related terms may indicate common descriptive patterns</li>
                                <li>The cloud reveals the semantic focus of the collection documentation</li>
                                <li>Helps identify core concepts and terminology used in artifact descriptions</li>
                            </ul>
                        </div>
                    </div>

                    <div class="chart-card">
                        <div class="chart-wrapper">
                            <h3>üèõÔ∏è Dynasty-Keyword Relationship</h3>
                            <div class="chart-container">
                                <canvas id="period-keyword-chart"></canvas>
                            </div>
                        </div>
                        <div class="analysis-text">
                            <h4>Analysis</h4>
                            <p>This chart explores the relationship between historical dynasties and descriptive keywords, revealing how terminology and emphasis may vary across different time periods in the collection.</p>
                            <p>Patterns identified:</p>
                            <ul>
                                <li>Certain keywords may be characteristic of specific dynasties, reflecting period-specific styles</li>
                                <li>Consistent keywords across periods suggest enduring descriptive themes</li>
                                <li>Variations in keyword usage may indicate evolving artistic techniques or documentation practices</li>
                                <li>Helps trace linguistic and stylistic evolution through historical periods</li>
                            </ul>
                        </div>
                    </div>

                    <div class="chart-card">
                        <div class="chart-wrapper">
                            <h3>üè∫ Object Type-Keyword Relationship</h3>
                            <div class="chart-container">
                                <canvas id="type-keyword-chart"></canvas>
                            </div>
                        </div>
                        <div class="analysis-text">
                            <h4>Analysis</h4>
                            <p>The object type-keyword relationship chart examines how different vessel forms are described, uncovering associations between physical characteristics and descriptive language.</p>
                            <p>Findings:</p>
                            <ul>
                                <li>Specific keywords may be strongly associated with particular object types</li>
                                <li>Common keywords across types suggest shared decorative or functional features</li>
                                <li>Unique keyword-object associations reveal distinctive characteristics of specific vessel forms</li>
                                <li>This analysis helps understand how form and function relate to descriptive terminology</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Relationship Map Area -->
                <div class="relationship-section">
                    <h2>üï∏Ô∏è Relationship Map</h2>
                    <div class="relationship-content">
                        <div class="relationship-chart-wrapper">
                            <div id="relationship-chart"></div>
                        </div>
                        <div class="relationship-analysis">
                            <h4>Analysis</h4>
                            <p>The relationship map visualizes the complex network of connections between dynasties, object types, and keywords in the blue and white porcelain collection. This interactive graph reveals hidden patterns and associations within the descriptive data.</p>
                            <p>Network characteristics:</p>
                            <ul>
                                <li>Node size represents the importance or frequency of each entity</li>
                                <li>Edge thickness indicates the strength of relationships between entities</li>
                                <li>Color coding distinguishes between different categories (dynasties, object types, keywords)</li>
                                <li>Clusters reveal groups of closely related entities</li>
                            </ul>
                            <p>Interpretation insights:</p>
                            <ul>
                                <li>Central nodes represent highly connected or influential entities</li>
                                <li>Isolated nodes may indicate unique or rare characteristics</li>
                                <li>Dense clusters suggest strong thematic or stylistic relationships</li>
                                <li>The network structure helps identify core concepts and peripheral elements in the collection</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let textAnalysisData = null;
        let charts = {};

        // Load text analysis data
        async function loadTextAnalysisData() {
            try {
                const response = await fetch('text_analysis_data.json');
                textAnalysisData = await response.json();
                
                // Update statistics cards
                const stats = textAnalysisData.statistics;
                document.getElementById('stat-total').textContent = stats.total_descriptions;
                document.getElementById('stat-avg-length').textContent = Math.round(stats.avg_length);
                document.getElementById('stat-keywords').textContent = stats.total_keywords;
                document.getElementById('stat-unique').textContent = stats.unique_keywords;
                
                // Create charts
                createKeywordChart();
                createWordCloudChart();
                createPeriodKeywordChart();
                createTypeKeywordChart();
                createRelationshipMap();
                
            } catch (error) {
                console.error('Failed to load text analysis data:', error);
                document.querySelector('.container').innerHTML = 
                    '<div style="text-align: center; padding: 40px; color: white; font-size: 1.2em;">Failed to load text analysis data. Please ensure text_analysis_data.json exists.</div>';
            }
        }

        // Create keyword frequency bar chart
        function createKeywordChart() {
            const ctx = document.getElementById('keyword-chart').getContext('2d');
            const keywordFreq = textAnalysisData.text_analysis.keyword_frequency;
            const sorted = Object.entries(keywordFreq)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 20);
            
            const labels = sorted.map(item => item[0]);
            const values = sorted.map(item => item[1]);
            
            if (charts.keyword) charts.keyword.destroy();
            
            charts.keyword = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Frequency',
                        data: values,
                        backgroundColor: '#2d7fc1'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    scales: {
                        x: {
                            beginAtZero: true
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        // Create word cloud chart (simulated with bar chart)
        function createWordCloudChart() {
            const ctx = document.getElementById('wordcloud-chart').getContext('2d');
            const keywordFreq = textAnalysisData.text_analysis.keyword_frequency;
            const sorted = Object.entries(keywordFreq)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 15);
            
            const labels = sorted.map(item => item[0]);
            const values = sorted.map(item => item[1]);
            
            // Set font size based on frequency
            const maxValue = Math.max(...values);
            const fontSizes = values.map(v => Math.max(10, (v / maxValue) * 20 + 10));
            
            if (charts.wordcloud) charts.wordcloud.destroy();
            
            charts.wordcloud = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Frequency',
                        data: values,
                        backgroundColor: '#a8d5e2'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            display: false
                        },
                        x: {
                            display: false
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        // Create dynasty-keyword relationship chart
        function createPeriodKeywordChart() {
            const ctx = document.getElementById('period-keyword-chart').getContext('2d');
            const periodKeywords = textAnalysisData.text_analysis.period_keywords;
            
            // Collect all keywords
            const allKeywords = new Set();
            Object.values(periodKeywords).forEach(kw => {
                Object.keys(kw).forEach(k => allKeywords.add(k));
            });
            
            const topKeywords = Array.from(allKeywords).slice(0, 10);
            const periods = Object.keys(periodKeywords);
            
            const datasets = periods.map((period, idx) => {
                const periodKw = periodKeywords[period];
                return {
                    label: period,
                    data: topKeywords.map(kw => periodKw[kw] || 0),
                    backgroundColor: `hsla(${idx * 360 / periods.length}, 70%, 50%, 0.7)`
                };
            });
            
            if (charts.periodKeyword) charts.periodKeyword.destroy();
            
            charts.periodKeyword = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: topKeywords,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            stacked: false
                        },
                        y: {
                            beginAtZero: true,
                            stacked: false
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    }
                }
            });
        }

        // Create object type-keyword relationship chart
        function createTypeKeywordChart() {
            const ctx = document.getElementById('type-keyword-chart').getContext('2d');
            const typeKeywords = textAnalysisData.text_analysis.type_keywords;
            
            // Select Top 10 object types
            const types = Object.keys(typeKeywords).slice(0, 10);
            const allKeywords = new Set();
            types.forEach(t => {
                Object.keys(typeKeywords[t] || {}).forEach(k => allKeywords.add(k));
            });
            
            const topKeywords = Array.from(allKeywords).slice(0, 10);
            
            const datasets = types.map((type, idx) => {
                const typeKw = typeKeywords[type] || {};
                return {
                    label: type,
                    data: topKeywords.map(kw => typeKw[kw] || 0),
                    backgroundColor: `hsla(${idx * 360 / types.length}, 70%, 50%, 0.7)`
                };
            });
            
            if (charts.typeKeyword) charts.typeKeyword.destroy();
            
            charts.typeKeyword = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: topKeywords,
                    datasets: datasets.slice(0, 5) // Limit to first 5 object types
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            stacked: false
                        },
                        y: {
                            beginAtZero: true,
                            stacked: false
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    }
                }
            });
        }

        // Create relationship map
        function createRelationshipMap() {
            const chart = echarts.init(document.getElementById('relationship-chart'));
            const relationshipData = textAnalysisData.relationship_map;
            
            // Create mapping from node ID to node object
            const nodeMap = {};
            relationshipData.nodes.forEach(node => {
                nodeMap[node.id] = node;
            });
            
            // Prepare node data
            const nodes = relationshipData.nodes.map(node => {
                let color = '#a8d5e2';
                let symbolSize = 30;
                let categoryIndex = 2;
                
                if (node.category === 'period') {
                    color = '#1a4d7a';
                    symbolSize = 50;
                    categoryIndex = 0;
                } else if (node.category === 'type') {
                    color = '#2d7fc1';
                    symbolSize = 40;
                    categoryIndex = 1;
                } else if (node.category === 'keyword') {
                    color = '#4a90a4';
                    symbolSize = Math.max(20, Math.min(35, node.value / 5));
                    categoryIndex = 2;
                }
                
                return {
                    id: node.id,
                    name: node.name,
                    category: categoryIndex,
                    value: node.value,
                    symbolSize: symbolSize,
                    itemStyle: {
                        color: color,
                        borderColor: '#fff',
                        borderWidth: 2
                    },
                    label: {
                        show: true,
                        fontSize: 12,
                        fontFamily: 'Noto Serif SC',
                        fontWeight: 500
                    }
                };
            });
            
            // Prepare link data (using node IDs)
            const links = relationshipData.links.map(link => {
                const sourceNode = nodeMap[link.source];
                const targetNode = nodeMap[link.target];
                return {
                    source: link.source,
                    target: link.target,
                    value: link.value,
                    lineStyle: {
                        width: Math.max(1, Math.min(5, link.value / 5)),
                        curveness: 0.3,
                        opacity: 0.6
                    }
                };
            });
            
            // Create categories
            const categories = [
                { name: 'Dynasty', itemStyle: { color: '#1a4d7a' } },
                { name: 'Object Type', itemStyle: { color: '#2d7fc1' } },
                { name: 'Keyword', itemStyle: { color: '#4a90a4' } }
            ];
            
            const option = {
                backgroundColor: 'transparent',
                tooltip: {
                    trigger: 'item',
                    formatter: function(params) {
                        if (params.dataType === 'edge') {
                            return `${params.data.source} ‚Üí ${params.data.target}<br/>Association Strength: ${params.data.value}`;
                        } else {
                            return `<strong>${params.data.name}</strong><br/>Category: ${categories[params.data.category].name}<br/>Weight: ${params.data.value}`;
                        }
                    },
                    backgroundColor: 'rgba(26, 77, 122, 0.9)',
                    borderColor: '#2d7fc1',
                    textStyle: {
                        color: '#fff',
                        fontFamily: 'Noto Serif SC'
                    }
                },
                legend: {
                    data: categories.map(c => c.name),
                    top: '5%',
                    textStyle: {
                        fontFamily: 'Noto Serif SC'
                    }
                },
                series: [{
                    type: 'graph',
                    layout: 'force',
                    animation: true,
                    data: nodes,
                    links: links,
                    categories: categories,
                    roam: true,
                    label: {
                        show: true,
                        position: 'right',
                        formatter: '{b}',
                        fontSize: 12,
                        fontFamily: 'Noto Serif SC'
                    },
                    labelLayout: {
                        hideOverlap: true
                    },
                    scaleLimit: {
                        min: 0.5,
                        max: 2
                    },
                    lineStyle: {
                        color: 'source',
                        curveness: 0.3,
                        opacity: 0.6
                    },
                    emphasis: {
                        focus: 'adjacency',
                        lineStyle: {
                            width: 3
                        }
                    },
                    force: {
                        repulsion: 300,
                        gravity: 0.15,
                        edgeLength: 150,
                        layoutAnimation: true
                    }
                }]
            };
            
            chart.setOption(option);
            
            // Responsive
            window.addEventListener('resize', () => {
                chart.resize();
            });
        }

        // Initialize on page load
        window.addEventListener('DOMContentLoaded', () => {
            loadTextAnalysisData();
        });
    </script>
</body>
</html>


<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–‡æœ¬åˆ†æ - é’èŠ±ç“·æ•°å­—åšç‰©é¦†</title>
    <!-- å¼•å…¥ä¸­æ–‡å­—ä½“ -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- ECharts -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <!-- Chart.js for å…¶ä»–å›¾è¡¨ -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* é’èŠ±ç“·ä¸»é¢˜è‰²å½©ä½“ç³» */
            --blue-dark: #1a4d7a;
            --blue-medium: #2d7fc1;
            --blue-light: #a8d5e2;
            --porcelain-white: #f8f8f6;
            --ink-black: #2c2c2c;
            --seal-red: #c94a3d;
            --paper-beige: #f5f1e8;
        }

        body {
            font-family: 'Noto Serif SC', 'æ€æºå®‹ä½“', 'SimSun', serif;
            background: linear-gradient(135deg, var(--blue-light) 0%, var(--porcelain-white) 100%);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.7;
            letter-spacing: 0.02em;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: var(--blue-dark);
            font-size: 2.5rem;
            font-weight: 700;
            text-shadow: 1px 1px 3px rgba(255,255,255,0.8);
            margin-bottom: 10px;
            letter-spacing: 0.05em;
        }

        .back-link {
            display: inline-block;
            color: var(--blue-dark);
            text-decoration: none;
            padding: 10px 20px;
            background: rgba(255,255,255,0.8);
            border: 2px solid var(--blue-medium);
            border-radius: 5px;
            margin-top: 10px;
            transition: all 0.3s;
        }

        .back-link:hover {
            background: var(--blue-medium);
            color: white;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            text-align: center;
        }

        .stat-card .value {
            font-size: 2em;
            font-weight: 700;
            color: var(--blue-medium);
            margin: 10px 0;
        }

        .stat-card .label {
            color: #666;
            font-size: 0.9em;
        }

        .analysis-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .chart-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .chart-card h3 {
            margin: 0 0 15px 0;
            color: var(--blue-dark);
            font-size: 1.2em;
            font-weight: 600;
            border-bottom: 2px solid var(--blue-medium);
            padding-bottom: 10px;
        }

        .chart-container {
            position: relative;
            height: 400px;
            margin-top: 10px;
        }

        .chart-container.large {
            height: 700px;
        }

        .chart-container.small {
            height: 300px;
        }

        .keyword-cloud {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            padding: 20px;
            justify-content: center;
            align-items: center;
        }

        .keyword-tag {
            padding: 8px 15px;
            border-radius: 20px;
            background: linear-gradient(135deg, var(--blue-light), var(--blue-medium));
            color: white;
            font-size: 14px;
            font-weight: 500;
            transition: transform 0.2s;
            cursor: pointer;
        }

        .keyword-tag:hover {
            transform: scale(1.1);
        }

        .relationship-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-top: 30px;
            box-shadow: 0 8px 24px rgba(26, 77, 122, 0.15);
        }

        .relationship-section h2 {
            color: var(--blue-dark);
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 20px;
            text-align: center;
            letter-spacing: 0.05em;
            border-bottom: 3px solid var(--blue-medium);
            padding-bottom: 15px;
        }

        .relationship-section .description {
            text-align: center;
            color: #666;
            margin-bottom: 20px;
            line-height: 1.8;
        }

        #relationship-chart {
            width: 100%;
            height: 800px;
            min-height: 600px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“ é’èŠ±ç“·æ–‡æœ¬åˆ†æ</h1>
            <a href="index.html" class="back-link">â† è¿”å›é¦–é¡µ</a>
        </div>

        <!-- ç»Ÿè®¡å¡ç‰‡ -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="label">æ€»æè¿°æ•°</div>
                <div class="value" id="stat-total">0</div>
            </div>
            <div class="stat-card">
                <div class="label">å¹³å‡é•¿åº¦</div>
                <div class="value" id="stat-avg-length">0</div>
            </div>
            <div class="stat-card">
                <div class="label">å…³é”®è¯æ€»æ•°</div>
                <div class="value" id="stat-keywords">0</div>
            </div>
            <div class="stat-card">
                <div class="label">å”¯ä¸€å…³é”®è¯</div>
                <div class="value" id="stat-unique">0</div>
            </div>
        </div>

        <!-- åˆ†æå›¾è¡¨åŒºåŸŸ -->
        <div class="analysis-container">
            <div class="chart-card">
                <h3>ğŸ”¤ å…³é”®è¯è¯é¢‘ï¼ˆTop 20ï¼‰</h3>
                <div class="chart-container">
                    <canvas id="keyword-chart"></canvas>
                </div>
            </div>

            <div class="chart-card">
                <h3>â˜ï¸ å…³é”®è¯äº‘å›¾</h3>
                <div class="chart-container small">
                    <canvas id="wordcloud-chart"></canvas>
                </div>
            </div>

            <div class="chart-card">
                <h3>ğŸ›ï¸ æœä»£-å…³é”®è¯å…³ç³»</h3>
                <div class="chart-container">
                    <canvas id="period-keyword-chart"></canvas>
                </div>
            </div>

            <div class="chart-card">
                <h3>ğŸº å™¨å‹-å…³é”®è¯å…³ç³»</h3>
                <div class="chart-container">
                    <canvas id="type-keyword-chart"></canvas>
                </div>
            </div>
        </div>

        <!-- å…³ç³»å›¾è°±åŒºåŸŸ -->
        <div class="relationship-section">
            <h2>ğŸ•¸ï¸ å…³ç³»å›¾è°±</h2>
            <p class="description">
                å¯è§†åŒ–å±•ç¤ºé’èŠ±ç“·æè¿°ä¸­æœä»£ã€å™¨å‹å’Œå…³é”®è¯ä¹‹é—´çš„å¤æ‚å…³ç³»ç½‘ç»œï¼Œæ­ç¤ºæ–‡æœ¬ä¸­çš„éšå«è”ç³»
            </p>
            <div id="relationship-chart"></div>
        </div>
    </div>

    <script>
        let textAnalysisData = null;
        let charts = {};

        // åŠ è½½æ–‡æœ¬åˆ†ææ•°æ®
        async function loadTextAnalysisData() {
            try {
                const response = await fetch('text_analysis_data.json');
                textAnalysisData = await response.json();
                
                // æ›´æ–°ç»Ÿè®¡å¡ç‰‡
                const stats = textAnalysisData.statistics;
                document.getElementById('stat-total').textContent = stats.total_descriptions;
                document.getElementById('stat-avg-length').textContent = Math.round(stats.avg_length);
                document.getElementById('stat-keywords').textContent = stats.total_keywords;
                document.getElementById('stat-unique').textContent = stats.unique_keywords;
                
                // åˆ›å»ºå›¾è¡¨
                createKeywordChart();
                createWordCloudChart();
                createPeriodKeywordChart();
                createTypeKeywordChart();
                createRelationshipMap();
                
            } catch (error) {
                console.error('åŠ è½½æ–‡æœ¬åˆ†ææ•°æ®å¤±è´¥:', error);
                document.querySelector('.container').innerHTML = 
                    '<div style="text-align: center; padding: 40px; color: #666; font-size: 1.2em;">åŠ è½½æ–‡æœ¬åˆ†ææ•°æ®å¤±è´¥ï¼Œè¯·ç¡®ä¿text_analysis_data.jsonæ–‡ä»¶å­˜åœ¨</div>';
            }
        }

        // åˆ›å»ºå…³é”®è¯è¯é¢‘æŸ±çŠ¶å›¾
        function createKeywordChart() {
            const ctx = document.getElementById('keyword-chart').getContext('2d');
            const keywordFreq = textAnalysisData.text_analysis.keyword_frequency;
            const sorted = Object.entries(keywordFreq)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 20);
            
            const labels = sorted.map(item => item[0]);
            const values = sorted.map(item => item[1]);
            
            if (charts.keyword) charts.keyword.destroy();
            
            charts.keyword = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'å‡ºç°æ¬¡æ•°',
                        data: values,
                        backgroundColor: '#2d7fc1'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    scales: {
                        x: {
                            beginAtZero: true
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        // åˆ›å»ºè¯äº‘å›¾ï¼ˆä½¿ç”¨æŸ±çŠ¶å›¾æ¨¡æ‹Ÿï¼‰
        function createWordCloudChart() {
            const ctx = document.getElementById('wordcloud-chart').getContext('2d');
            const keywordFreq = textAnalysisData.text_analysis.keyword_frequency;
            const sorted = Object.entries(keywordFreq)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 15);
            
            const labels = sorted.map(item => item[0]);
            const values = sorted.map(item => item[1]);
            
            // æ ¹æ®é¢‘ç‡è®¾ç½®å­—ä½“å¤§å°
            const maxValue = Math.max(...values);
            const fontSizes = values.map(v => Math.max(10, (v / maxValue) * 20 + 10));
            
            if (charts.wordcloud) charts.wordcloud.destroy();
            
            charts.wordcloud = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'é¢‘ç‡',
                        data: values,
                        backgroundColor: '#a8d5e2'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            display: false
                        },
                        x: {
                            display: false
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        // åˆ›å»ºæœä»£-å…³é”®è¯å…³ç³»å›¾
        function createPeriodKeywordChart() {
            const ctx = document.getElementById('period-keyword-chart').getContext('2d');
            const periodKeywords = textAnalysisData.text_analysis.period_keywords;
            
            // æ”¶é›†æ‰€æœ‰å…³é”®è¯
            const allKeywords = new Set();
            Object.values(periodKeywords).forEach(kw => {
                Object.keys(kw).forEach(k => allKeywords.add(k));
            });
            
            const topKeywords = Array.from(allKeywords).slice(0, 10);
            const periods = Object.keys(periodKeywords);
            
            const datasets = periods.map((period, idx) => {
                const periodKw = periodKeywords[period];
                return {
                    label: period,
                    data: topKeywords.map(kw => periodKw[kw] || 0),
                    backgroundColor: `hsla(${idx * 360 / periods.length}, 70%, 50%, 0.7)`
                };
            });
            
            if (charts.periodKeyword) charts.periodKeyword.destroy();
            
            charts.periodKeyword = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: topKeywords,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            stacked: false
                        },
                        y: {
                            beginAtZero: true,
                            stacked: false
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    }
                }
            });
        }

        // åˆ›å»ºå™¨å‹-å…³é”®è¯å…³ç³»å›¾
        function createTypeKeywordChart() {
            const ctx = document.getElementById('type-keyword-chart').getContext('2d');
            const typeKeywords = textAnalysisData.text_analysis.type_keywords;
            
            // é€‰æ‹©Top 10å™¨å‹
            const types = Object.keys(typeKeywords).slice(0, 10);
            const allKeywords = new Set();
            types.forEach(t => {
                Object.keys(typeKeywords[t] || {}).forEach(k => allKeywords.add(k));
            });
            
            const topKeywords = Array.from(allKeywords).slice(0, 10);
            
            const datasets = types.map((type, idx) => {
                const typeKw = typeKeywords[type] || {};
                return {
                    label: type,
                    data: topKeywords.map(kw => typeKw[kw] || 0),
                    backgroundColor: `hsla(${idx * 360 / types.length}, 70%, 50%, 0.7)`
                };
            });
            
            if (charts.typeKeyword) charts.typeKeyword.destroy();
            
            charts.typeKeyword = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: topKeywords,
                    datasets: datasets.slice(0, 5) // é™åˆ¶æ˜¾ç¤ºå‰5ä¸ªå™¨å‹
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            stacked: false
                        },
                        y: {
                            beginAtZero: true,
                            stacked: false
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    }
                }
            });
        }

        // åˆ›å»ºå…³ç³»å›¾è°±
        function createRelationshipMap() {
            const chart = echarts.init(document.getElementById('relationship-chart'));
            const relationshipData = textAnalysisData.relationship_map;
            
            // åˆ›å»ºèŠ‚ç‚¹IDåˆ°èŠ‚ç‚¹å¯¹è±¡çš„æ˜ å°„
            const nodeMap = {};
            relationshipData.nodes.forEach(node => {
                nodeMap[node.id] = node;
            });
            
            // å‡†å¤‡èŠ‚ç‚¹æ•°æ®
            const nodes = relationshipData.nodes.map(node => {
                let color = '#a8d5e2';
                let symbolSize = 30;
                let categoryIndex = 2;
                
                if (node.category === 'period') {
                    color = '#1a4d7a';
                    symbolSize = 50;
                    categoryIndex = 0;
                } else if (node.category === 'type') {
                    color = '#2d7fc1';
                    symbolSize = 40;
                    categoryIndex = 1;
                } else if (node.category === 'keyword') {
                    color = '#4a90a4';
                    symbolSize = Math.max(20, Math.min(35, node.value / 5));
                    categoryIndex = 2;
                }
                
                return {
                    id: node.id,
                    name: node.name,
                    category: categoryIndex,
                    value: node.value,
                    symbolSize: symbolSize,
                    itemStyle: {
                        color: color,
                        borderColor: '#fff',
                        borderWidth: 2
                    },
                    label: {
                        show: true,
                        fontSize: 12,
                        fontFamily: 'Noto Serif SC',
                        fontWeight: 500
                    }
                };
            });
            
            // å‡†å¤‡é“¾æ¥æ•°æ®ï¼ˆä½¿ç”¨èŠ‚ç‚¹IDï¼‰
            const links = relationshipData.links.map(link => {
                const sourceNode = nodeMap[link.source];
                const targetNode = nodeMap[link.target];
                return {
                    source: link.source,
                    target: link.target,
                    value: link.value,
                    lineStyle: {
                        width: Math.max(1, Math.min(5, link.value / 5)),
                        curveness: 0.3,
                        opacity: 0.6
                    }
                };
            });
            
            // åˆ›å»ºåˆ†ç±»
            const categories = [
                { name: 'æœä»£', itemStyle: { color: '#1a4d7a' } },
                { name: 'å™¨å‹', itemStyle: { color: '#2d7fc1' } },
                { name: 'å…³é”®è¯', itemStyle: { color: '#4a90a4' } }
            ];
            
            const option = {
                backgroundColor: 'transparent',
                tooltip: {
                    trigger: 'item',
                    formatter: function(params) {
                        if (params.dataType === 'edge') {
                            return `${params.data.source} â†’ ${params.data.target}<br/>å…³è”å¼ºåº¦: ${params.data.value}`;
                        } else {
                            return `<strong>${params.data.name}</strong><br/>ç±»åˆ«: ${categories[params.data.category].name}<br/>æƒé‡: ${params.data.value}`;
                        }
                    },
                    backgroundColor: 'rgba(26, 77, 122, 0.9)',
                    borderColor: '#2d7fc1',
                    textStyle: {
                        color: '#fff',
                        fontFamily: 'Noto Serif SC'
                    }
                },
                legend: {
                    data: categories.map(c => c.name),
                    top: '5%',
                    textStyle: {
                        fontFamily: 'Noto Serif SC'
                    }
                },
                series: [{
                    type: 'graph',
                    layout: 'force',
                    animation: true,
                    data: nodes,
                    links: links,
                    categories: categories,
                    roam: true,
                    label: {
                        show: true,
                        position: 'right',
                        formatter: '{b}',
                        fontSize: 12,
                        fontFamily: 'Noto Serif SC'
                    },
                    labelLayout: {
                        hideOverlap: true
                    },
                    scaleLimit: {
                        min: 0.5,
                        max: 2
                    },
                    lineStyle: {
                        color: 'source',
                        curveness: 0.3,
                        opacity: 0.6
                    },
                    emphasis: {
                        focus: 'adjacency',
                        lineStyle: {
                            width: 3
                        }
                    },
                    force: {
                        repulsion: 300,
                        gravity: 0.15,
                        edgeLength: 150,
                        layoutAnimation: true
                    }
                }]
            };
            
            chart.setOption(option);
            
            // å“åº”å¼
            window.addEventListener('resize', () => {
                chart.resize();
            });
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.addEventListener('DOMContentLoaded', () => {
            loadTextAnalysisData();
        });
    </script>
</body>
</html>


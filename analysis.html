<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Analysis - Blue & White Museum</title>
    <!-- ÂºïÂÖ•‰∏≠ÊñáÂ≠ó‰Ωì -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* ÈùíËä±Áì∑‰∏ªÈ¢òËâ≤ÂΩ©‰ΩìÁ≥ª */
            --blue-dark: #1a4d7a;
            --blue-medium: #2d7fc1;
            --blue-light: #a8d5e2;
            --porcelain-white: #f8f8f6;
            --ink-black: #2c2c2c;
            --seal-red: #c94a3d;
            --paper-beige: #f5f1e8;
        }

        body {
            font-family: 'Noto Serif SC', 'ÊÄùÊ∫êÂÆã‰Ωì', 'SimSun', serif;
            background: linear-gradient(135deg, var(--blue-medium) 0%, var(--blue-light) 100%);
            min-height: 100vh;
            padding: 40px 20px 20px;
            line-height: 1.7;
            letter-spacing: 0.02em;
        }

        .page-layout {
            display: flex;
        }

        .nav-column {
            position: fixed;
            top: 25px;
            left: 25px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            z-index: 10;
        }

        .nav-link {
            background: transparent;
            border: none;
            color: rgba(255,255,255,0.85);
            font-size: 1rem;
            letter-spacing: 0.35em;
            padding: 6px 0;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            text-align: left;
            font-family: 'Noto Serif SC', serif;
            font-weight: 500;
        }

        .nav-link:hover {
            text-shadow: 0 10px 22px rgba(0, 0, 0, 0.3), 0 0 28px rgba(255,255,255,0.65);
        }

        .main-content {
            margin-left: 0;
            width: 100%;
            padding-top: 10px;
        }

        .title-container {
            text-align: center;
            margin-bottom: 30px;
        }

        .title-container h1 {
            color: white;
            font-size: 2.5rem;
            font-weight: 700;
            text-shadow: 2px 2px 8px rgba(0,0,0,0.5), 0 0 20px rgba(26, 77, 122, 0.4);
            letter-spacing: 0.1em;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            text-align: center;
        }

        .stat-card .value {
            font-size: 2em;
            font-weight: 700;
            color: var(--blue-medium);
            margin: 10px 0;
        }

        .stat-card .label {
            color: #666;
            font-size: 0.9em;
        }

        .analysis-container {
            display: flex;
            flex-direction: column;
            gap: 30px;
            margin-bottom: 20px;
        }

        .chart-card {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: row;
            gap: 30px;
            align-items: flex-start;
        }

        .chart-card h3 {
            margin: 0 0 20px 0;
            color: var(--blue-dark);
            font-size: 1.3em;
            font-weight: 600;
            border-bottom: 2px solid var(--blue-medium);
            padding-bottom: 10px;
            width: 100%;
        }

        .chart-wrapper {
            flex: 1;
            min-width: 0;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin-top: 10px;
        }

        .chart-container.large {
            height: 400px;
        }

        .analysis-text {
            flex: 1;
            min-width: 0;
            padding-left: 20px;
            border-left: 2px solid var(--blue-light);
        }

        .analysis-text h4 {
            color: var(--blue-dark);
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: 12px;
        }

        .analysis-text p {
            color: #555;
            line-height: 1.8;
            font-size: 0.95em;
            margin-bottom: 10px;
        }

        .analysis-text ul {
            color: #555;
            line-height: 1.8;
            font-size: 0.95em;
            padding-left: 20px;
            margin-top: 10px;
        }

        .analysis-text li {
            margin-bottom: 8px;
        }

        @media (max-width: 900px) {
            .chart-card {
                flex-direction: column;
            }

            .analysis-text {
                padding-left: 0;
                padding-top: 20px;
                border-left: none;
                border-top: 2px solid var(--blue-light);
            }
        }

        .data-table {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            overflow-x: auto;
        }

        .data-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th,
        .data-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .data-table th {
            background: var(--blue-light);
            color: var(--blue-dark);
            font-weight: 600;
        }

        .data-table tr:hover {
            background: rgba(168, 213, 226, 0.2);
        }

        @media (max-width: 900px) {
            .page-layout {
                flex-direction: column;
                align-items: center;
            }

            .nav-column {
                position: static;
                flex-direction: row;
                justify-content: center;
                gap: 15px;
                margin-bottom: 20px;
            }

            .nav-link {
                letter-spacing: 0.2em;
                text-align: center;
                font-size: 0.9rem;
            }

            .main-content {
                padding-top: 0;
            }
        }
    </style>
</head>
<body>
    <div class="page-layout">
        <div class="nav-column">
            <button class="nav-link" onclick="window.location.href='index.html'">MAIN PAGE</button>
        </div>
        <div class="main-content">
            <div class="container">
                <div class="title-container">
                    <h1>DATA ANALYSIS</h1>
                </div>

                <div class="stats-grid" id="stats-grid">
                    <div class="stat-card">
                        <div class="label">Total Records</div>
                        <div class="value" id="stat-total">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="label">Dynasty Types</div>
                        <div class="value" id="stat-periods">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="label">Object Types</div>
                        <div class="value" id="stat-types">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="label">Decorative Elements</div>
                        <div class="value" id="stat-elements">0</div>
                    </div>
                </div>

                <div class="analysis-container">
                    <div class="chart-card">
                        <div class="chart-wrapper">
                            <h3>üìä Dynasty Distribution</h3>
                            <div class="chart-container">
                                <canvas id="periods-chart"></canvas>
                            </div>
                        </div>
                        <div class="analysis-text">
                            <h4>Analysis</h4>
                            <p>The dynasty distribution pie chart reveals the temporal spread of blue and white porcelain artifacts across different historical periods. This visualization helps identify which dynasties contributed most significantly to the collection.</p>
                            <p>Key insights include:</p>
                            <ul>
                                <li>The relative proportion of artifacts from each dynasty period</li>
                                <li>Historical periods with the highest artifact production or preservation rates</li>
                                <li>Potential gaps in the collection that may indicate historical transitions or preservation challenges</li>
                            </ul>
                        </div>
                    </div>

                    <div class="chart-card">
                        <div class="chart-wrapper">
                            <h3>üè∫ Object Type Distribution (Top 15)</h3>
                            <div class="chart-container">
                                <canvas id="types-chart"></canvas>
                            </div>
                        </div>
                        <div class="analysis-text">
                            <h4>Analysis</h4>
                            <p>This bar chart displays the top 15 most common object types in the collection, providing insight into the functional diversity and cultural preferences of blue and white porcelain production.</p>
                            <p>Observations:</p>
                            <ul>
                                <li>The most prevalent vessel forms reflect daily use patterns and ceremonial functions</li>
                                <li>Variations in object types may indicate different production centers or periods</li>
                                <li>Rare object types suggest specialized functions or unique artistic expressions</li>
                            </ul>
                        </div>
                    </div>

                    <div class="chart-card">
                        <div class="chart-wrapper">
                            <h3>üé® Decorative Element Distribution (Top 15)</h3>
                            <div class="chart-container">
                                <canvas id="elements-chart"></canvas>
                            </div>
                        </div>
                        <div class="analysis-text">
                            <h4>Analysis</h4>
                            <p>The decorative element distribution highlights the most frequently used motifs and patterns in blue and white porcelain design, revealing aesthetic preferences and cultural symbolism.</p>
                            <p>Key findings:</p>
                            <ul>
                                <li>Common motifs reflect traditional Chinese artistic themes and natural elements</li>
                                <li>Pattern frequency may indicate cultural significance or production techniques</li>
                                <li>Variations in decorative elements can help identify regional styles or time periods</li>
                            </ul>
                        </div>
                    </div>

                    <div class="chart-card">
                        <div class="chart-wrapper">
                            <h3>üìÖ Time Distribution (by Century)</h3>
                            <div class="chart-container">
                                <canvas id="years-chart"></canvas>
                            </div>
                        </div>
                        <div class="analysis-text">
                            <h4>Analysis</h4>
                            <p>This line chart tracks the chronological distribution of artifacts across centuries, showing trends in production, preservation, and collection acquisition over time.</p>
                            <p>Trends observed:</p>
                            <ul>
                                <li>Peak periods may indicate golden ages of porcelain production or better preservation conditions</li>
                                <li>Declines could reflect historical events, economic changes, or preservation challenges</li>
                                <li>The overall trajectory provides context for the evolution of blue and white porcelain artistry</li>
                            </ul>
                        </div>
                    </div>

                    <div class="chart-card">
                        <div class="chart-wrapper">
                            <h3>üìè Height Distribution</h3>
                            <div class="chart-container">
                                <canvas id="height-chart"></canvas>
                            </div>
                        </div>
                        <div class="analysis-text">
                            <h4>Analysis</h4>
                            <p>The height distribution chart categorizes artifacts by size ranges, revealing the dimensional characteristics of the collection and functional relationships between size and object type.</p>
                            <p>Insights:</p>
                            <ul>
                                <li>Size ranges reflect different functional purposes‚Äîfrom small decorative pieces to large storage vessels</li>
                                <li>Height variations may correlate with specific dynasties or production techniques</li>
                                <li>The distribution helps understand the scale diversity within the collection</li>
                            </ul>
                        </div>
                    </div>

                    <div class="chart-card">
                        <div class="chart-wrapper">
                            <h3>üîÑ Dynasty-Object Type Relationship</h3>
                            <div class="chart-container large">
                                <canvas id="heatmap-chart"></canvas>
                            </div>
                        </div>
                        <div class="analysis-text">
                            <h4>Analysis</h4>
                            <p>This grouped bar chart explores the relationship between dynasties and object types, revealing how vessel forms evolved or remained consistent across different historical periods.</p>
                            <p>Patterns identified:</p>
                            <ul>
                                <li>Certain object types may be characteristic of specific dynasties</li>
                                <li>Continuity in object types across periods suggests enduring cultural practices</li>
                                <li>Emergence of new forms may indicate technological innovations or cultural shifts</li>
                                <li>The visualization helps trace the evolution of ceramic artistry through time</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="data-table">
                    <h3 style="margin-bottom: 15px; color: var(--blue-dark); font-weight: 600;">üìã Detailed Data Table</h3>
                    <div style="margin-bottom: 10px;">
                        <input type="text" id="table-search" placeholder="Search..." style="padding: 8px; width: 300px; border: 2px solid #ddd; border-radius: 5px;">
                        <select id="table-filter-period" style="padding: 8px; margin-left: 10px; border: 2px solid #ddd; border-radius: 5px;">
                            <option value="">All Dynasties</option>
                        </select>
                        <select id="table-filter-type" style="padding: 8px; margin-left: 10px; border: 2px solid #ddd; border-radius: 5px;">
                            <option value="">All Object Types</option>
                        </select>
                    </div>
            <div style="max-height: 500px; overflow-y: auto;">
                <table id="data-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Date</th>
                            <th>Dynasty</th>
                            <th>Object Type</th>
                            <th>Height</th>
                            <th>Decorative Elements</th>
                        </tr>
                    </thead>
                    <tbody id="table-body">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        let analysisData = null;
        let charts = {};

        // Load analysis data and create charts
        async function loadAnalysisData() {
            try {
                const response = await fetch('analysis_data.json');
                analysisData = await response.json();
                
                // Update statistics cards
                document.getElementById('stat-total').textContent = Object.values(analysisData.periods).reduce((a, b) => a + b, 0);
                document.getElementById('stat-periods').textContent = Object.keys(analysisData.periods).length;
                document.getElementById('stat-types').textContent = Object.keys(analysisData.types).length;
                document.getElementById('stat-elements').textContent = Object.keys(analysisData.elements).length;
                
                // Create charts
                createPeriodsChart();
                createTypesChart();
                createElementsChart();
                createYearsChart();
                createHeightChart();
                createHeatmapChart();
                createDataTable();
                
            } catch (error) {
                console.error('Failed to load analysis data:', error);
                document.querySelector('.container').innerHTML = 
                    '<div style="text-align: center; padding: 40px; color: white; font-size: 1.2em;">Failed to load analysis data. Please ensure analysis_data.json exists.</div>';
            }
        }

        // Create dynasty distribution pie chart
        function createPeriodsChart() {
            const ctx = document.getElementById('periods-chart').getContext('2d');
            const labels = Object.keys(analysisData.periods);
            const values = Object.values(analysisData.periods);
            
            if (charts.periods) charts.periods.destroy();
            
            charts.periods = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: labels,
                    datasets: [{
                        data: values,
                        backgroundColor: [
                            '#1a4d7a', '#2d7fc1', '#a8d5e2', '#4a90a4',
                            '#6ba8c4', '#8bc0d4', '#a8d5e2', '#c5e0ed'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right'
                        }
                    }
                }
            });
        }

        // Create object type distribution bar chart
        function createTypesChart() {
            const ctx = document.getElementById('types-chart').getContext('2d');
            const sorted = Object.entries(analysisData.types)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 15);
            const labels = sorted.map(item => item[0]);
            const values = sorted.map(item => item[1]);
            
            if (charts.types) charts.types.destroy();
            
            charts.types = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Count',
                        data: values,
                        backgroundColor: '#2d7fc1'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        // Create decorative element bar chart
        function createElementsChart() {
            const ctx = document.getElementById('elements-chart').getContext('2d');
            const sorted = Object.entries(analysisData.elements)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 15);
            const labels = sorted.map(item => item[0]);
            const values = sorted.map(item => item[1]);
            
            if (charts.elements) charts.elements.destroy();
            
            charts.elements = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Frequency',
                        data: values,
                        backgroundColor: '#a8d5e2'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    scales: {
                        x: {
                            beginAtZero: true
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        // Create time distribution line chart
        function createYearsChart() {
            const ctx = document.getElementById('years-chart').getContext('2d');
            const sorted = Object.entries(analysisData.year_bins)
                .sort((a, b) => parseInt(a[0]) - parseInt(b[0]));
            const labels = sorted.map(item => item[0]);
            const values = sorted.map(item => item[1]);
            
            if (charts.years) charts.years.destroy();
            
            charts.years = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Count',
                        data: values,
                        borderColor: '#2d7fc1',
                        backgroundColor: 'rgba(45, 127, 193, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // Create height distribution bar chart
        function createHeightChart() {
            const ctx = document.getElementById('height-chart').getContext('2d');
            const sorted = Object.entries(analysisData.height_bins)
                .sort((a, b) => {
                    const order = ['0-5cm', '5-10cm', '10-20cm', '20-30cm', '30-50cm', '50cm+'];
                    return order.indexOf(a[0]) - order.indexOf(b[0]);
                });
            const labels = sorted.map(item => item[0]);
            const values = sorted.map(item => item[1]);
            
            if (charts.height) charts.height.destroy();
            
            charts.height = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Count',
                        data: values,
                        backgroundColor: '#a8d5e2'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        // Create heatmap (dynasty-object type relationship)
        function createHeatmapChart() {
            const ctx = document.getElementById('heatmap-chart').getContext('2d');
            const periods = Object.keys(analysisData.period_type_cross);
            const allTypes = [...new Set(Object.values(analysisData.period_type_cross).flatMap(obj => Object.keys(obj)))];
            
            // Prepare data
            const datasets = periods.map((period, idx) => {
                const periodData = analysisData.period_type_cross[period];
                return {
                    label: period,
                    data: allTypes.map(type => periodData[type] || 0),
                    backgroundColor: `hsl(${idx * 360 / periods.length}, 70%, 50%)`
                };
            });
            
            if (charts.heatmap) charts.heatmap.destroy();
            
            charts.heatmap = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: allTypes.slice(0, 20),
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            stacked: false
                        },
                        y: {
                            beginAtZero: true,
                            stacked: false
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    }
                }
            });
        }

        // Create data table
        async function createDataTable() {
            try {
                const response = await fetch('Processed_Data.csv');
                const text = await response.text();
                const lines = text.split('\n');
                
                // Parse CSV
                const tableData = [];
                for (let i = 1; i < lines.length; i++) {
                    if (lines[i].trim() === '') continue;
                    const values = parseCSVLine(lines[i]);
                    if (values.length >= 9) {
                        tableData.push({
                            id: values[0] || '',
                            date: values[1] || '',
                            period: values[4] || '',
                            type: values[8] || '',
                            height: values[2] || '',
                            element: values[7] || ''
                        });
                    }
                }
                
                // Populate filter options
                const periods = [...new Set(tableData.map(d => d.period).filter(Boolean))].sort();
                const types = [...new Set(tableData.map(d => d.type).filter(Boolean))].sort();
                
                const periodSelect = document.getElementById('table-filter-period');
                periods.forEach(p => {
                    const option = document.createElement('option');
                    option.value = p;
                    option.textContent = p;
                    periodSelect.appendChild(option);
                });
                
                const typeSelect = document.getElementById('table-filter-type');
                types.forEach(t => {
                    const option = document.createElement('option');
                    option.value = t;
                    option.textContent = t;
                    typeSelect.appendChild(option);
                });
                
                // Render table
                function renderTable(data) {
                    const tbody = document.getElementById('table-body');
                    tbody.innerHTML = data.map(item => `
                        <tr>
                            <td>${item.id}</td>
                            <td>${item.date}</td>
                            <td>${item.period}</td>
                            <td>${item.type}</td>
                            <td>${item.height}</td>
                            <td>${item.element || '-'}</td>
                        </tr>
                    `).join('');
                }
                
                renderTable(tableData);
                
                // Search and filter
                function filterTable() {
                    const search = document.getElementById('table-search').value.toLowerCase();
                    const periodFilter = document.getElementById('table-filter-period').value;
                    const typeFilter = document.getElementById('table-filter-type').value;
                    
                    const filtered = tableData.filter(item => {
                        const matchSearch = !search || 
                            item.id.toLowerCase().includes(search) ||
                            item.date.toLowerCase().includes(search) ||
                            item.period.toLowerCase().includes(search) ||
                            item.type.toLowerCase().includes(search) ||
                            (item.element && item.element.toLowerCase().includes(search));
                        const matchPeriod = !periodFilter || item.period === periodFilter;
                        const matchType = !typeFilter || item.type === typeFilter;
                        return matchSearch && matchPeriod && matchType;
                    });
                    
                    renderTable(filtered);
                }
                
                document.getElementById('table-search').addEventListener('input', filterTable);
                document.getElementById('table-filter-period').addEventListener('change', filterTable);
                document.getElementById('table-filter-type').addEventListener('change', filterTable);
                
            } catch (error) {
                console.error('Failed to load table data:', error);
            }
        }

        // CSV parsing helper function
        function parseCSVLine(line) {
            const values = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                const nextChar = line[i + 1];
                
                if (char === '"') {
                    if (inQuotes && nextChar === '"') {
                        current += '"';
                        i++;
                    } else {
                        inQuotes = !inQuotes;
                    }
                } else if (char === ',' && !inQuotes) {
                    values.push(current.trim());
                    current = '';
                } else {
                    current += char;
                }
            }
            values.push(current.trim());
            return values;
        }

        // Initialize on page load
        window.addEventListener('DOMContentLoaded', () => {
            loadAnalysisData();
        });
    </script>
</body>
</html>

